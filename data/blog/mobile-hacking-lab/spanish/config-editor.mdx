---
title: 'Config Editor'
date: '2024-07-13'
lastmod: '2023-08-05'
tags: ['spanish', 'labs', 'mobile', 'android', 'mobilehackinglabs', 'RCE', 'CVE-2022-1471']
draft: true
summary: 'En este laboratorio de MobileHackingLab se sumergirá en una situación realista que involucra vulnerabilidades en una biblioteca de terceros ampliamente utilizada. El objetivo es ejecutar con éxito ,código remoto mediante la explotación de una vulnerabilidad en una biblioteca de terceros. '
images: ['/static/images/config-editor/']
---


## Introduccion

![logo strings](/static/images/config-editor/1.png)

En este laboratorio de [MobileHackingLab](https://www.mobilehackinglab.com/link/gnVA9O) se sumergirá 
en una situación realista que involucra vulnerabilidades en una biblioteca de terceros ampliamente utilizada. 
El objetivo es ejecutar con éxito ,código remoto mediante la explotación de una vulnerabilidad 
en una biblioteca de terceros. 

<TOCInline toc={props.toc} exclude="Introduccion" />

## 1.Superficie De Ataque


Al abrir la app, nos pide acceso al dispositivo. Tambien notamos dos botones:
uno de `carga` y otro para `guardar`.
![Image](/static/images/config-editor/2.png)


Podemos cargar un archivo de texto y tambien editarlo, para posteriormente guardarlo
con una extension `.yml`.
![Image](/static/images/config-editor/3.png)
![Image](/static/images/config-editor/4.png)
Y esas son todas las funcionalidades que tiene la app:
Carga un archivo de texto, te permite editarlo para luego, guardarlo en formato .yml.

## 2.Code Review
### 2.1.AndroidManifest

![Image](/static/images/config-editor/5.png)

Este bloque de codigo define la `MainActivity` de la app como la pantalla de inicio
cuando el usuario abre la app. Tambien,permite que reciba y maneje `intents` que contengan
datos con los `schema`: `file`,`http` o `https` y que tienen el tipo MIME   `application/yaml`.
Osea que puede abrir archivos YAML desde el sistema de archivos o desde enlaces web.

### 2.2.MainActivity

```java
private final void handleIntent() {
        Intent intent = getIntent();
        String action = intent.getAction();
        Uri data = intent.getData();
        if (Intrinsics.areEqual("android.intent.action.VIEW", action) && data != null) {
            CopyUtil.INSTANCE.copyFileFromUri(data).observe(this, new MainActivity$sam$androidx_lifecycle_Observer$0(new Function1<Uri, Unit>() { // from class: com.mobilehackinglab.configeditor.MainActivity$handleIntent$1
                /* JADX INFO: Access modifiers changed from: package-private */
                {
                    super(1);
                }

                @Override // kotlin.jvm.functions.Function1
                public /* bridge */ /* synthetic */ Unit invoke(Uri uri) {
                    invoke2(uri);
                    return Unit.INSTANCE;
                }

                /* renamed from: invoke, reason: avoid collision after fix types in other method */
                public final void invoke2(Uri uri) {
                    MainActivity mainActivity = MainActivity.this;
                    Intrinsics.checkNotNull(uri);
                    mainActivity.loadYaml(uri);
                }
            }));
        }
    }
```
En resumen ste metodo maneja `intents` con la `action` [android.intent.action.VIEW](https://medium.com/asos-techblog/a-rundown-of-android-intent-selectors-youre-building-intents-wrong-fdb8d3e58ce2)
y una URI de datos, pero vamos a desglozarlo.

```java
Intent intent = getIntent();
String action = intent.getAction();
Uri data = intent.getData();
```
Obtiene el Intent que inició la actividad y extrae la action y data del intent.

```java
 if (Intrinsics.areEqual("android.intent.action.VIEW", action) && data != null) { ... }
```
Verifica si la acción es VIEW y si los datos no son nulos.

```java
CopyUtil.INSTANCE.copyFileFromUri(data).observe(this, new MainActivity$sam$androidx_lifecycle_Observer$0(new Function1<Uri, Unit>() ))
```
Copia el archivo desde la Uri a un lugar accesible dentro de la aplicación usando CopyUtil.

```java
mainActivity.loadYaml(uri);
```
Observa el resultado de la operación de copia y, cuando la operación completa, llama al método `loadYaml()` para procesar el archivo YAML.

### 2.3.Load and Save YAML






---

## References

1. https://www.mscharhag.com/security/snakeyaml-vulnerability-cve-2022-1471
2. https://medium.com/asos-techblog/a-rundown-of-android-intent-selectors-youre-building-intents-wrong-fdb8d3e58ce2